<!DOCTYPE html>
<html>
    <head>
        <title></title>
          <!-- Import @tensorflow/tfjs-core -->
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
        <!-- Adds the CPU backend -->
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-cpu"></script>
        <!-- Import @tensorflow/tfjs-tflite -->
        <script src="./tf-tflite.js"></script>

        <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
    </head>
    <body>

        <button class="button" id="clickme">
            Click me!
        </button>

        <div id="result"></div>
        

    <script>
        $(() =>{
        let modelUrl = '/sin_model.tflite';

            fetch(modelUrl)
                .then(r => r.arrayBuffer())
                .then(async array => {
                    console.log(array)
                // array().then(array => {
                    const modelrunner = await tfweb.TFLiteWebModelRunner.createFromBuffer(new Uint8Array(array), {numThreads: navigator.hardwareConcurrency / 2});
                // })
                
                    
                    let model = new tf.TFLiteModel(modelrunner);
                    let inputs = [];
                    let outputs = [];
                    var trace1 = {
                            x: inputs,
                            y: outputs,
                            type: 'scatter',
                            mode:'markers'
                            };

                          

                            var data = [trace1];

                            Plotly.newPlot('result', data);


                    $('#clickme').click(() => {

                        let input = Math.random() * 6.0;
                        inputs.push(input);
                        let outputTensor = model.predict(tf.tensor([input]));

                        let output = outputTensor.dataSync();
                        outputs.push(output[0]);
                        Plotly.redraw('result');
                        
                    })
                    
                });
                
            })

    </script>
    </body>
</html>