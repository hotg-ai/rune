<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A counterpart of [`Archive`] that’s suitable for unsized types."><meta name="keywords" content="rust, rustlang, rust-lang, ArchiveUnsized"><title>ArchiveUnsized in rkyv - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="shortcut icon" href="
    data:image/svg+xml,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27;
    viewBox=&#x27;0 0 26.458 26.458&#x27;%3E%3Cpath d=&#x27;M0 0v26.458h26.458V0zm9.175 3.772l8.107 8.106
    2.702-2.702 2.702 13.512-13.512-2.702 2.703-2.702-8.107-8.107z&#x27;/%3E%3C/svg%3E
"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../rkyv/index.html"><div class="logo-container"><img src="
    data:image/svg+xml,%3Csvg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;100&quot; height=&quot;100&quot;
    viewBox=&quot;0 0 26.458 26.458&quot;%3E%3Cpath d=&quot;M0 0v26.458h26.458V0zm9.175 3.772l8.107 8.106
    2.702-2.702 2.702 13.512-13.512-2.702 2.703-2.702-8.107-8.107z&quot;/%3E%3C/svg%3E
" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../rkyv/index.html"><div class="logo-container">
                    <img src="
    data:image/svg+xml,%3Csvg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;100&quot; height=&quot;100&quot;
    viewBox=&quot;0 0 26.458 26.458&quot;%3E%3Cpath d=&quot;M0 0v26.458h26.458V0zm9.175 3.772l8.107 8.106
    2.702-2.702 2.702 13.512-13.512-2.702 2.703-2.702-8.107-8.107z&quot;/%3E%3C/svg%3E
" alt="logo"></div>
        </a><h2 class="location"><a href="#">ArchiveUnsized</a></h2><div class="sidebar-elems"><section><div class="block"><h3 class="sidebar-title"><a href="#associated-types">Associated Types</a></h3><ul><li><a href="#associatedtype.Archived">Archived</a></li><li><a href="#associatedtype.MetadataResolver">MetadataResolver</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><ul><li><a href="#tymethod.resolve_metadata">resolve_metadata</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><ul><li><a href="#method.resolve_unsized">resolve_unsized</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#foreign-impls">Implementations on Foreign Types</a></h3><ul><li><a href="#impl-ArchiveUnsized-for-CStr">CStr</a></li><li><a href="#impl-ArchiveUnsized-for-%5BT%5D">[T]</a></li><li><a href="#impl-ArchiveUnsized-for-str">str</a></li></ul></div><div class="block"><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div></section><h2 class="location"><a href="index.html">In rkyv</a></h2><div id="sidebar-vars" data-name="ArchiveUnsized" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../rkyv/index.html">
                        <img src="
    data:image/svg+xml,%3Csvg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;100&quot; height=&quot;100&quot;
    viewBox=&quot;0 0 26.458 26.458&quot;%3E%3Cpath d=&quot;M0 0v26.458h26.458V0zm9.175 3.772l8.107 8.106
    2.702-2.702 2.702 13.512-13.512-2.702 2.703-2.702-8.107-8.107z&quot;/%3E%3C/svg%3E
" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Trait <a href="index.html">rkyv</a>::<wbr><a class="trait" href="#">ArchiveUnsized</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/rkyv/lib.rs.html#615-670">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><div class="docblock item-decl"><pre class="rust trait"><code>pub trait ArchiveUnsized: <a class="trait" href="../ptr_meta/trait.Pointee.html" title="trait ptr_meta::Pointee">Pointee</a> {
    type <a href="#associatedtype.Archived" class="associatedtype">Archived</a>: <a class="trait" href="trait.ArchivePointee.html" title="trait rkyv::ArchivePointee">ArchivePointee</a> + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a>;
    type <a href="#associatedtype.MetadataResolver" class="associatedtype">MetadataResolver</a>;
    unsafe fn <a href="#tymethod.resolve_metadata" class="fnname">resolve_metadata</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pos: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolver: Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.MetadataResolver" title="type rkyv::ArchiveUnsized::MetadataResolver">MetadataResolver</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="type.ArchivedMetadata.html" title="type rkyv::ArchivedMetadata">ArchivedMetadata</a>&lt;Self&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;);

    unsafe fn <a href="#method.resolve_unsized" class="fnname">resolve_unsized</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resolver: Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.MetadataResolver" title="type rkyv::ArchiveUnsized::MetadataResolver">MetadataResolver</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;out: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="type.RelPtr.html" title="type rkyv::RelPtr">RelPtr</a>&lt;Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.Archived" title="type rkyv::ArchiveUnsized::Archived">Archived</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) { ... }
}</code></pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A counterpart of <a href="trait.Archive.html" title="Archive"><code>Archive</code></a> that’s suitable for unsized types.</p>
<p>Unlike <code>Archive</code>, types that implement <code>ArchiveUnsized</code> must be serialized separately from their
owning object. For example, whereas an <code>i32</code> might be laid out as part of a larger struct, a
<code>Box&lt;i32&gt;</code> would serialize the <code>i32</code> somewhere in the archive and the <code>Box</code> would point to it as
part of the larger struct. Because of this, the equivalent <a href="trait.Archive.html#associatedtype.Resolver"><code>Resolver</code></a> type
for <code>ArchiveUnsized</code> is always a <code>usize</code> representing the position of the serialized value.</p>
<p><code>ArchiveUnsized</code> is automatically implemented for all types that implement <a href="trait.Archive.html" title="Archive"><code>Archive</code></a>. Nothing
special needs to be done to use them with types like <code>Box</code>, <code>Rc</code>, and <code>Arc</code>. It is also already
implemented for slices and string slices, and the <code>rkyv_dyn</code> crate can be used to archive trait
objects. Other unsized types must manually implement <code>ArchiveUnsized</code>.</p>
<h2 id="examples"><a href="#examples">Examples</a></h2>
<p>This example shows how to manually implement <code>ArchiveUnsized</code> for an unsized type. Special care
must be taken to ensure that the types are laid out correctly.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use</span> <span class="ident">core</span>::{<span class="ident">mem::transmute</span>, <span class="ident">ops</span>::{<span class="ident">Deref</span>, <span class="ident">DerefMut</span>}};
<span class="kw">use</span> <span class="ident">ptr_meta::Pointee</span>;
<span class="kw">use</span> <span class="ident">rkyv</span>::{
    <span class="ident">from_archived</span>,
    <span class="ident">to_archived</span>,
    <span class="ident">archived_unsized_value</span>,
    <span class="ident">ser</span>::{<span class="ident">serializers::AlignedSerializer</span>, <span class="ident">Serializer</span>},
    <span class="ident">AlignedVec</span>,
    <span class="ident">Archive</span>,
    <span class="ident">Archived</span>,
    <span class="ident">ArchivedMetadata</span>,
    <span class="ident">ArchivePointee</span>,
    <span class="ident">ArchiveUnsized</span>,
    <span class="ident">FixedUsize</span>,
    <span class="ident">RelPtr</span>,
    <span class="ident">Serialize</span>,
    <span class="ident">SerializeUnsized</span>,
};

<span class="comment">// We&#39;re going to be dealing mostly with blocks that have a trailing slice</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">Block</span><span class="op">&lt;</span><span class="ident">H</span>, <span class="ident">T</span>: <span class="question-mark">?</span><span class="ident">Sized</span><span class="op">&gt;</span> {
    <span class="ident">head</span>: <span class="ident">H</span>,
    <span class="ident">tail</span>: <span class="ident">T</span>,
}

<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">H</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">Pointee</span> <span class="kw">for</span> <span class="ident">Block</span><span class="op">&lt;</span><span class="ident">H</span>, [<span class="ident">T</span>]<span class="op">&gt;</span> {
    <span class="kw">type</span> <span class="ident">Metadata</span> <span class="op">=</span> <span class="ident">usize</span>;
}

<span class="comment">// For blocks with trailing slices, we need to store the length of the slice</span>
<span class="comment">// in the metadata.</span>
<span class="kw">pub</span> <span class="kw">struct</span> <span class="ident">BlockSliceMetadata</span> {
    <span class="ident">len</span>: <span class="ident">Archived</span><span class="op">&lt;</span><span class="ident">usize</span><span class="op">&gt;</span>,
}

<span class="comment">// ArchivePointee is automatically derived for sized types because pointers</span>
<span class="comment">// to sized types don&#39;t need to store any extra information. Because we&#39;re</span>
<span class="comment">// making an unsized block, we need to define what metadata gets stored with</span>
<span class="comment">// our data pointer.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">H</span>, <span class="ident">T</span><span class="op">&gt;</span> <span class="ident">ArchivePointee</span> <span class="kw">for</span> <span class="ident">Block</span><span class="op">&lt;</span><span class="ident">H</span>, [<span class="ident">T</span>]<span class="op">&gt;</span> {
    <span class="comment">// This is the extra data that needs to get stored for blocks with</span>
    <span class="comment">// trailing slices</span>
    <span class="kw">type</span> <span class="ident">ArchivedMetadata</span> <span class="op">=</span> <span class="ident">BlockSliceMetadata</span>;

    <span class="comment">// We need to be able to turn our archived metadata into regular</span>
    <span class="comment">// metadata for our type</span>
    <span class="kw">fn</span> <span class="ident">pointer_metadata</span>(
        <span class="ident">archived</span>: <span class="kw-2">&amp;</span><span class="ident"><span class="self">Self</span>::ArchivedMetadata</span>
    ) -&gt; <span class="op">&lt;</span><span class="self">Self</span> <span class="kw">as</span> <span class="ident">Pointee</span><span class="op">&gt;</span><span class="ident">::Metadata</span> {
        <span class="macro">from_archived!</span>(<span class="ident">archived</span>.<span class="ident">len</span>) <span class="kw">as</span> <span class="ident">usize</span>
    }
}

<span class="comment">// We&#39;re implementing ArchiveUnsized for just Block&lt;H, [T]&gt;. We can still</span>
<span class="comment">// implement Archive for blocks with sized tails and they won&#39;t conflict.</span>
<span class="kw">impl</span><span class="op">&lt;</span><span class="ident">H</span>: <span class="ident">Archive</span>, <span class="ident">T</span>: <span class="ident">Archive</span><span class="op">&gt;</span> <span class="ident">ArchiveUnsized</span> <span class="kw">for</span> <span class="ident">Block</span><span class="op">&lt;</span><span class="ident">H</span>, [<span class="ident">T</span>]<span class="op">&gt;</span> {
    <span class="comment">// We&#39;ll reuse our block type as our archived type.</span>
    <span class="kw">type</span> <span class="ident">Archived</span> <span class="op">=</span> <span class="ident">Block</span><span class="op">&lt;</span><span class="ident">Archived</span><span class="op">&lt;</span><span class="ident">H</span><span class="op">&gt;</span>, [<span class="ident">Archived</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>]<span class="op">&gt;</span>;

    <span class="comment">// This is where we&#39;d put any resolve data for our metadata.</span>
    <span class="comment">// Most of the time, this can just be () because most metadata is Copy,</span>
    <span class="comment">// but the option is there if you need it.</span>
    <span class="kw">type</span> <span class="ident">MetadataResolver</span> <span class="op">=</span> ();

    <span class="comment">// Here&#39;s where we make the metadata for our pointer.</span>
    <span class="comment">// This also gets the position and resolver for the metadata, but we</span>
    <span class="comment">// don&#39;t need it in this case.</span>
    <span class="kw">unsafe</span> <span class="kw">fn</span> <span class="ident">resolve_metadata</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="kw">_</span>: <span class="ident">usize</span>,
        <span class="kw">_</span>: <span class="ident"><span class="self">Self</span>::MetadataResolver</span>,
        <span class="ident">out</span>: <span class="kw-2">*mut</span> <span class="ident">ArchivedMetadata</span><span class="op">&lt;</span><span class="self">Self</span><span class="op">&gt;</span>,
    ) {
        <span class="kw">unsafe</span> {
            <span class="ident">out</span>.<span class="ident">write</span>(<span class="ident">BlockSliceMetadata</span> {
                <span class="ident">len</span>: <span class="macro">to_archived!</span>(<span class="self">self</span>.<span class="ident">tail</span>.<span class="ident">len</span>() <span class="kw">as</span> <span class="ident">FixedUsize</span>),
            });
        }
    }
}

<span class="comment">// The bounds we use on our serializer type indicate that we need basic</span>
<span class="comment">// serializer capabilities, and then whatever capabilities our head and tail</span>
<span class="comment">// types need to serialize themselves.</span>
<span class="kw">impl</span><span class="op">&lt;</span>
    <span class="ident">H</span>: <span class="ident">Serialize</span><span class="op">&lt;</span><span class="ident">S</span><span class="op">&gt;</span>,
    <span class="ident">T</span>: <span class="ident">Serialize</span><span class="op">&lt;</span><span class="ident">S</span><span class="op">&gt;</span>,
    <span class="ident">S</span>: <span class="ident">Serializer</span> <span class="op">+</span> <span class="question-mark">?</span><span class="ident">Sized</span>
<span class="op">&gt;</span> <span class="ident">SerializeUnsized</span><span class="op">&lt;</span><span class="ident">S</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">Block</span><span class="op">&lt;</span><span class="ident">H</span>, [<span class="ident">T</span>]<span class="op">&gt;</span> {
    <span class="comment">// This is where we construct our unsized type in the serializer</span>
    <span class="kw">fn</span> <span class="ident">serialize_unsized</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="ident">serializer</span>: <span class="kw-2">&amp;mut</span> <span class="ident">S</span>
    ) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">usize</span>, <span class="ident">S::Error</span><span class="op">&gt;</span> {
        <span class="comment">// First, we archive the head and all the tails. This will make sure</span>
        <span class="comment">// that when we finally build our block, we don&#39;t accidentally mess</span>
        <span class="comment">// up the structure with serialized dependencies.</span>
        <span class="kw">let</span> <span class="ident">head_resolver</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">head</span>.<span class="ident">serialize</span>(<span class="ident">serializer</span>)<span class="question-mark">?</span>;
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">resolvers</span> <span class="op">=</span> <span class="ident">Vec::new</span>();
        <span class="kw">for</span> <span class="ident">tail</span> <span class="kw">in</span> <span class="self">self</span>.<span class="ident">tail</span>.<span class="ident">iter</span>() {
            <span class="ident">resolvers</span>.<span class="ident">push</span>(<span class="ident">tail</span>.<span class="ident">serialize</span>(<span class="ident">serializer</span>)<span class="question-mark">?</span>);
        }
        <span class="comment">// Now we align our serializer for our archived type and write it.</span>
        <span class="comment">// We can&#39;t align for unsized types so we treat the trailing slice</span>
        <span class="comment">// like an array of 0 length for now.</span>
        <span class="ident">serializer</span>.<span class="ident">align_for</span>::<span class="op">&lt;</span><span class="ident">Block</span><span class="op">&lt;</span><span class="ident">Archived</span><span class="op">&lt;</span><span class="ident">H</span><span class="op">&gt;</span>, [<span class="ident">Archived</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span>; <span class="number">0</span>]<span class="op">&gt;</span><span class="op">&gt;</span>()<span class="question-mark">?</span>;
        <span class="kw">let</span> <span class="ident">result</span> <span class="op">=</span> <span class="kw">unsafe</span> {
            <span class="ident">serializer</span>.<span class="ident">resolve_aligned</span>(<span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">head</span>, <span class="ident">head_resolver</span>)<span class="question-mark">?</span>
        };
        <span class="ident">serializer</span>.<span class="ident">align_for</span>::<span class="op">&lt;</span><span class="ident">Archived</span><span class="op">&lt;</span><span class="ident">T</span><span class="op">&gt;</span><span class="op">&gt;</span>()<span class="question-mark">?</span>;
        <span class="kw">for</span> (<span class="ident">item</span>, <span class="ident">resolver</span>) <span class="kw">in</span> <span class="self">self</span>.<span class="ident">tail</span>.<span class="ident">iter</span>().<span class="ident">zip</span>(<span class="ident">resolvers</span>.<span class="ident">drain</span>(..)) {
            <span class="kw">unsafe</span> {
                <span class="ident">serializer</span>.<span class="ident">resolve_aligned</span>(<span class="ident">item</span>, <span class="ident">resolver</span>)<span class="question-mark">?</span>;
            }
        }
        <span class="prelude-val">Ok</span>(<span class="ident">result</span>)
    }

    <span class="comment">// This is where we serialize the metadata for our type. In this case,</span>
    <span class="comment">// we do all the work in resolve and don&#39;t need to do anything here.</span>
    <span class="kw">fn</span> <span class="ident">serialize_metadata</span>(
        <span class="kw-2">&amp;</span><span class="self">self</span>,
        <span class="ident">serializer</span>: <span class="kw-2">&amp;mut</span> <span class="ident">S</span>
    ) -&gt; <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident"><span class="self">Self</span>::MetadataResolver</span>, <span class="ident">S::Error</span><span class="op">&gt;</span> {
        <span class="prelude-val">Ok</span>(())
    }
}

<span class="kw">let</span> <span class="ident">value</span> <span class="op">=</span> <span class="ident">Block</span> {
    <span class="ident">head</span>: <span class="string">&quot;Numbers 1-4&quot;</span>.<span class="ident">to_string</span>(),
    <span class="ident">tail</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],
};
<span class="comment">// We have a Block&lt;String, [i32; 4]&gt; but we want to it to be a</span>
<span class="comment">// Block&lt;String, [i32]&gt;, so we need to do more pointer transmutation</span>
<span class="kw">let</span> <span class="ident">ptr</span> <span class="op">=</span> (<span class="kw-2">&amp;</span><span class="ident">value</span> <span class="kw">as</span> <span class="kw-2">*const</span> <span class="ident">Block</span><span class="op">&lt;</span><span class="ident">String</span>, [<span class="ident">i32</span>; <span class="number">4</span>]<span class="op">&gt;</span>).<span class="ident">cast</span>::<span class="op">&lt;</span>()<span class="op">&gt;</span>();
<span class="kw">let</span> <span class="ident">unsized_value</span> <span class="op">=</span> <span class="kw">unsafe</span> {
    <span class="kw-2">&amp;</span><span class="kw-2">*</span><span class="ident">transmute</span>::<span class="op">&lt;</span>(<span class="kw-2">*const</span> (), <span class="ident">usize</span>), <span class="kw-2">*const</span> <span class="ident">Block</span><span class="op">&lt;</span><span class="ident">String</span>, [<span class="ident">i32</span>]<span class="op">&gt;</span><span class="op">&gt;</span>((<span class="ident">ptr</span>, <span class="number">4</span>))
};

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">serializer</span> <span class="op">=</span> <span class="ident">AlignedSerializer::new</span>(<span class="ident">AlignedVec::new</span>());
<span class="kw">let</span> <span class="ident">pos</span> <span class="op">=</span> <span class="ident">serializer</span>.<span class="ident">serialize_unsized_value</span>(<span class="ident">unsized_value</span>)
    .<span class="ident">expect</span>(<span class="string">&quot;failed to archive block&quot;</span>);
<span class="kw">let</span> <span class="ident">buf</span> <span class="op">=</span> <span class="ident">serializer</span>.<span class="ident">into_inner</span>();

<span class="kw">let</span> <span class="ident">archived_ref</span> <span class="op">=</span> <span class="kw">unsafe</span> {
    <span class="ident">archived_unsized_value</span>::<span class="op">&lt;</span><span class="ident">Block</span><span class="op">&lt;</span><span class="ident">String</span>, [<span class="ident">i32</span>]<span class="op">&gt;</span><span class="op">&gt;</span>(<span class="ident">buf</span>.<span class="ident">as_slice</span>(), <span class="ident">pos</span>)
};
<span class="macro">assert_eq!</span>(<span class="ident">archived_ref</span>.<span class="ident">head</span>, <span class="string">&quot;Numbers 1-4&quot;</span>);
<span class="macro">assert_eq!</span>(<span class="ident">archived_ref</span>.<span class="ident">tail</span>.<span class="ident">len</span>(), <span class="number">4</span>);
<span class="macro">assert_eq!</span>(<span class="ident">archived_ref</span>.<span class="ident">tail</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</code></pre></div>
</div></details><h2 id="associated-types" class="small-section-header">Associated Types<a href="#associated-types" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="associatedtype.Archived" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/rkyv/lib.rs.html#620">source</a></div><h4 class="code-header">type <a href="#associatedtype.Archived" class="associatedtype">Archived</a>: <a class="trait" href="trait.ArchivePointee.html" title="trait rkyv::ArchivePointee">ArchivePointee</a> + ?<a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sized.html" title="trait core::marker::Sized">Sized</a></h4></div></summary><div class="docblock"><p>The archived counterpart of this type. Unlike <code>Archive</code>, it may be unsized.</p>
<p>This type must implement <a href="trait.ArchivePointee.html" title="ArchivePointee"><code>ArchivePointee</code></a>, a trait that helps make valid pointers using
archived pointer metadata.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="associatedtype.MetadataResolver" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/rkyv/lib.rs.html#626">source</a></div><h4 class="code-header">type <a href="#associatedtype.MetadataResolver" class="associatedtype">MetadataResolver</a></h4></div></summary><div class="docblock"><p>The resolver for the metadata of this type.</p>
<p>Because the pointer metadata must be archived with the relative pointer and not with the
structure itself, its resolver must be passed back to the structure holding the pointer.</p>
</div></details></div><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="tymethod.resolve_metadata" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/rkyv/lib.rs.html#640-645">source</a></div><h4 class="code-header">unsafe fn <a href="#tymethod.resolve_metadata" class="fnname">resolve_metadata</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;pos: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;resolver: Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.MetadataResolver" title="type rkyv::ArchiveUnsized::MetadataResolver">MetadataResolver</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;out: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="type.ArchivedMetadata.html" title="type rkyv::ArchivedMetadata">ArchivedMetadata</a>&lt;Self&gt;<br>)</h4></div></summary><div class="docblock"><p>Creates the archived version of the metadata for this value at the given position and writes
it to the given output.</p>
<p>The output should be initialized field-by-field rather than by writing a whole struct.
Performing a typed copy will mark all of the padding bytes as uninitialized, but they must
remain set to the value they currently have. This prevents leaking uninitialized memory to
the final archive.</p>
<h5 id="safety"><a href="#safety">Safety</a></h5>
<ul>
<li><code>pos</code> must be the position of <code>out</code> within the archive</li>
<li><code>resolver</code> must be the result of serializing this object’s metadata</li>
</ul>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.resolve_unsized" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/rkyv/lib.rs.html#661-669">source</a></div><h4 class="code-header">unsafe fn <a href="#method.resolve_unsized" class="fnname">resolve_unsized</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;from: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;to: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;resolver: Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.MetadataResolver" title="type rkyv::ArchiveUnsized::MetadataResolver">MetadataResolver</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;out: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="type.RelPtr.html" title="type rkyv::RelPtr">RelPtr</a>&lt;Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.Archived" title="type rkyv::ArchiveUnsized::Archived">Archived</a>&gt;<br>)</h4></div></summary><div class="docblock"><p>Resolves a relative pointer to this value with the given <code>from</code> and <code>to</code> and writes it to
the given output.</p>
<p>The output should be initialized field-by-field rather than by writing a whole struct.
Performing a typed copy will mark all of the padding bytes as uninitialized, but they must
remain set to the value they currently have. This prevents leaking uninitialized memory to
the final archive.</p>
<h5 id="safety-1"><a href="#safety-1">Safety</a></h5>
<ul>
<li><code>from</code> must be the position of <code>out</code> within the archive</li>
<li><code>to</code> must be the position of some <code>Self::Archived</code> within the archive</li>
<li><code>resolver</code> must be the result of serializing this object</li>
</ul>
</div></details></div><h2 id="foreign-impls" class="small-section-header">Implementations on Foreign Types<a href="#foreign-impls" class="anchor"></a></h2><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-ArchiveUnsized-for-%5BT%5D" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../src/rkyv/impls/core/mod.rs.html#177-191">source</a></span><a href="#impl-ArchiveUnsized-for-%5BT%5D" class="anchor"></a><h3 class="code-header in-band">impl&lt;T:&nbsp;<a class="trait" href="trait.Archive.html" title="trait rkyv::Archive">Archive</a>&gt; <a class="trait" href="trait.ArchiveUnsized.html" title="trait rkyv::ArchiveUnsized">ArchiveUnsized</a> for <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">[</a>T<a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">]</a></h3></section></summary><div class="impl-items"><section id="associatedtype.Archived-1" class="type trait-impl has-srclink"><a href="#associatedtype.Archived-1" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Archived" class="associatedtype">Archived</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">[</a>T::<a class="associatedtype" href="trait.Archive.html#associatedtype.Archived" title="type rkyv::Archive::Archived">Archived</a><a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.slice.html">]</a></h4></section><section id="associatedtype.MetadataResolver-1" class="type trait-impl has-srclink"><a href="#associatedtype.MetadataResolver-1" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.MetadataResolver" class="associatedtype">MetadataResolver</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a></h4></section><section id="method.resolve_metadata" class="method trait-impl has-srclink"><span class="rightside"><a class="srclink" href="../src/rkyv/impls/core/mod.rs.html#183-190">source</a></span><a href="#method.resolve_metadata" class="anchor"></a><h4 class="code-header">unsafe fn <a href="#tymethod.resolve_metadata" class="fnname">resolve_metadata</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;_: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;_: Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.MetadataResolver" title="type rkyv::ArchiveUnsized::MetadataResolver">MetadataResolver</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;out: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="type.ArchivedMetadata.html" title="type rkyv::ArchivedMetadata">ArchivedMetadata</a>&lt;Self&gt;<br>)</h4></section></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-ArchiveUnsized-for-str" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../src/rkyv/impls/core/mod.rs.html#311-325">source</a></span><a href="#impl-ArchiveUnsized-for-str" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="trait.ArchiveUnsized.html" title="trait rkyv::ArchiveUnsized">ArchiveUnsized</a> for <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a></h3></section></summary><div class="docblock"><p><code>str</code></p>
</div><div class="impl-items"><section id="associatedtype.Archived-2" class="type trait-impl has-srclink"><a href="#associatedtype.Archived-2" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Archived" class="associatedtype">Archived</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.str.html">str</a></h4></section><section id="associatedtype.MetadataResolver-2" class="type trait-impl has-srclink"><a href="#associatedtype.MetadataResolver-2" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.MetadataResolver" class="associatedtype">MetadataResolver</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a></h4></section><section id="method.resolve_metadata-1" class="method trait-impl has-srclink"><span class="rightside"><a class="srclink" href="../src/rkyv/impls/core/mod.rs.html#317-324">source</a></span><a href="#method.resolve_metadata-1" class="anchor"></a><h4 class="code-header">unsafe fn <a href="#tymethod.resolve_metadata" class="fnname">resolve_metadata</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;_: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;_: Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.MetadataResolver" title="type rkyv::ArchiveUnsized::MetadataResolver">MetadataResolver</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;out: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="type.ArchivedMetadata.html" title="type rkyv::ArchivedMetadata">ArchivedMetadata</a>&lt;Self&gt;<br>)</h4></section></div></details><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-ArchiveUnsized-for-CStr" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../src/rkyv/impls/std/ffi.rs.html#14-28">source</a></span><a href="#impl-ArchiveUnsized-for-CStr" class="anchor"></a><h3 class="code-header in-band">impl <a class="trait" href="trait.ArchiveUnsized.html" title="trait rkyv::ArchiveUnsized">ArchiveUnsized</a> for <a class="struct" href="https://doc.rust-lang.org/nightly/std/ffi/c_str/struct.CStr.html" title="struct std::ffi::c_str::CStr">CStr</a></h3></section></summary><div class="impl-items"><section id="associatedtype.Archived-3" class="type trait-impl has-srclink"><a href="#associatedtype.Archived-3" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Archived" class="associatedtype">Archived</a> = <a class="struct" href="https://doc.rust-lang.org/nightly/std/ffi/c_str/struct.CStr.html" title="struct std::ffi::c_str::CStr">CStr</a></h4></section><section id="associatedtype.MetadataResolver-3" class="type trait-impl has-srclink"><a href="#associatedtype.MetadataResolver-3" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.MetadataResolver" class="associatedtype">MetadataResolver</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a></h4></section><section id="method.resolve_metadata-2" class="method trait-impl has-srclink"><span class="rightside"><a class="srclink" href="../src/rkyv/impls/std/ffi.rs.html#20-27">source</a></span><a href="#method.resolve_metadata-2" class="anchor"></a><h4 class="code-header">unsafe fn <a href="#tymethod.resolve_metadata" class="fnname">resolve_metadata</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;_: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.usize.html">usize</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;_: Self::<a class="associatedtype" href="trait.ArchiveUnsized.html#associatedtype.MetadataResolver" title="type rkyv::ArchiveUnsized::MetadataResolver">MetadataResolver</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;out: <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.pointer.html">*mut </a><a class="type" href="type.ArchivedMetadata.html" title="type rkyv::ArchivedMetadata">ArchivedMetadata</a>&lt;Self&gt;<br>)</h4></section></div></details><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"><details class="rustdoc-toggle implementors-toggle"><summary><section id="impl-ArchiveUnsized" class="impl has-srclink"><span class="rightside"><a class="srclink" href="../src/rkyv/impls/core/mod.rs.html#24-37">source</a></span><a href="#impl-ArchiveUnsized" class="anchor"></a><h3 class="code-header in-band">impl&lt;T:&nbsp;<a class="trait" href="trait.Archive.html" title="trait rkyv::Archive">Archive</a>&gt; <a class="trait" href="trait.ArchiveUnsized.html" title="trait rkyv::ArchiveUnsized">ArchiveUnsized</a> for T</h3></section></summary><div class="impl-items"><section id="associatedtype.Archived-4" class="type trait-impl has-srclink"><a href="#associatedtype.Archived-4" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.Archived" class="associatedtype">Archived</a> = T::<a class="associatedtype" href="trait.Archive.html#associatedtype.Archived" title="type rkyv::Archive::Archived">Archived</a></h4></section><section id="associatedtype.MetadataResolver-4" class="type trait-impl has-srclink"><a href="#associatedtype.MetadataResolver-4" class="anchor"></a><h4 class="code-header">type <a href="#associatedtype.MetadataResolver" class="associatedtype">MetadataResolver</a> = <a class="primitive" href="https://doc.rust-lang.org/nightly/std/primitive.unit.html">()</a></h4></section></div></details></div><script type="text/javascript" src="../implementors/rkyv/trait.ArchiveUnsized.js" async></script></section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="rkyv" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.61.0-nightly (10cc7a6d0 2022-02-26)" ></div>
</body></html>